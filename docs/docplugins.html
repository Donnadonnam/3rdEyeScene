<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>3rd Eye Scene: Message Handler Plugins</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">3rd Eye Scene
   </div>
   <div id="projectbrief">3rd Eye Scene documentation</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('docplugins.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Message Handler Plugins </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The 3<sup>rd</sup> Eye Scene protocol is extensible and allows for user defined messages. Writing 3<sup>rd</sup> Eye Scene handles for user messages requires authoring of a viewer plugin. Viewer plugins are .Net DLLs which include derivations of the <code><a class="el" href="classTes_1_1Runtime_1_1MessageHandler.html" title="This class defines the interface for any message handler class. ">Tes.Runtime.MessageHandler</a></code> for dealing with user messages.</p>
<p>Most <code><a class="el" href="classTes_1_1Runtime_1_1MessageHandler.html">MessageHandler</a></code> implementations deal with 3D objects; primitives, meshes and text. However, some message handlers deal with other types of data. The <code><a class="el" href="classTes_1_1Handlers_1_1CategoriesHandler.html">CategoriesHandler</a></code> for example, manages the names of and links between categories and has 3D representation. User messages may follow either pattern, depending on the need.</p>
<p>For example, in games, user messages may be used to visualise an agent's game attributes in a single message. Health, primary AI state, ammunition, etc. may be collated into a much smaller single message as opposed to using multiple text messages.</p>
<h1><a class="anchor" id="secauthoring"></a>
Authoring a 3rd Eye Scene Plugin</h1>
<p>To author a 3<sup>rd</sup> Eye Scene plugin;</p><ol type="1">
<li>Define the messages for the user entities (generally shapes)</li>
<li>Create a .Net project file which references:<ul>
<li>3esCore library</li>
<li>3esRuntime library</li>
<li>UnityEngine library*</li>
</ul>
</li>
<li>Implement the client messages in C# and equivalent server messages in C++</li>
<li>Create a handler class deriving <code><a class="el" href="classTes_1_1Runtime_1_1MessageHandler.html" title="This class defines the interface for any message handler class. ">Tes.Runtime.MessageHandler</a></code> </li>
<li>Implement the abstract methods to:<ul>
<li>Define a Unity <code>GameObject</code> to act as a root for all objects created by this handler.</li>
<li>In <code>MessageHandler.Initialise()</code> add the handler's root <code>GameObject</code> either to:<ul>
<li>the scene <code>root</code> if the handler's object transformation coordinates are in the server's coordinate frame, or</li>
<li>to the <code>serverRoot</code> if the handler's object transformation coordinates are in Unity's coordinate frame</li>
</ul>
</li>
<li>Handle the new messages, creating Unity objects as required</li>
<li>Discriminate transient and persistent objects based on the object ID</li>
<li>Serialise shapes on request</li>
</ul>
</li>
<li>Build the plugin DLL</li>
<li><p class="startli">Copy the DLL to the viewer's plugin directory (create this directory alongside the executable).</p><ul>
<li>Note: plugins are also searched for in 3rd-Eye-Scene_Data/Managed</li>
</ul>
<p class="startli">See <a class="el" href="docplugins.html#subreferenceunityengine">Referencing Unity Engine</a> for guidelines on referencing UnityEngine.dll</p>
</li>
</ol>
<h2><a class="anchor" id="subreferenceunityengine"></a>
Referencing Unity Engine</h2>
<p>The 3esRuntime library serves an example of how to reference the UnityEngine dll in a cross platform way. This relies on a few assumptions:</p><ul>
<li>Using conditional blocks in the MSBuild project file (3esRuntime.csproj)</li>
<li>Using the <code>UNITY_DLL_PATH</code> environment variable to locate the DLL when possible</li>
<li>Falling back to finding UnityEngine.dll in a known, platform specific location</li>
</ul>
<p>A discussion of MSBuild files is beyond the scope of this documentation, other than to note that both Visual Studio and Xamarin Studio use MSBuild files to control compilation and both support conditional blocks.</p>
<p>Essentially, 3esRuntime.csproj references UnityEngine.DLL via the XML code below. The same code can be used to reference the DLL in other .Net project files. Be aware that this code must be manually edited into the project file as Visual Studio and Xamarin Studio do not support creating conditional statements via the <a class="el" href="namespaceUI.html">UI</a>, but do respect them on reading such project files.</p>
<div class="fragment"><div class="line">&lt;<span class="keywordtype">ItemGroup</span>&gt;</div><div class="line">  &lt;<span class="keywordtype">Reference</span> <span class="keyword">Include</span>=<span class="stringliteral">&quot;UnityEngine&quot;</span> <span class="keyword">Condition</span>=<span class="stringliteral">&quot;!Exists(&#39;$(UNITY_DLL_PATH)&#39;) And Exists(&#39;\\Applications\\Unity\\Unity.app\\Contents\\Managed\\UnityEngine.dll&#39;) &quot;</span>&gt;</div><div class="line">    &lt;<span class="keywordtype">HintPath</span>&gt;\<span class="keyword">Applications</span>\<span class="keyword">Unity</span>\<span class="keyword">Unity.app</span>\<span class="keyword">Contents</span>\<span class="keyword">Managed</span>\<span class="keyword">UnityEngine.dll</span>&lt;/<span class="keywordtype">HintPath</span>&gt;</div><div class="line">    &lt;<span class="keywordtype">Private</span>&gt;<span class="keyword">False</span>&lt;/<span class="keywordtype">Private</span>&gt;</div><div class="line">  &lt;/<span class="keywordtype">Reference</span>&gt;</div><div class="line">  &lt;<span class="keywordtype">Reference</span> <span class="keyword">Include</span>=<span class="stringliteral">&quot;UnityEngine&quot;</span> <span class="keyword">Condition</span>=<span class="stringliteral">&quot;!Exists(&#39;$(UNITY_DLL_PATH)&#39;) And Exists(&#39;C:\\Program Files\\Unity\\Editor\\Data\\Managed\\UnityEngine.dll&#39;) &quot;</span>&gt;</div><div class="line">    &lt;<span class="keywordtype">HintPath</span>&gt;<span class="keyword">C:</span>\<span class="keyword">Program</span> <span class="keyword">Files</span>\<span class="keyword">Unity</span>\<span class="keyword">Editor</span>\<span class="keyword">Data</span>\<span class="keyword">Managed</span>\<span class="keyword">UnityEngine.dll</span>&lt;/<span class="keywordtype">HintPath</span>&gt;</div><div class="line">    &lt;<span class="keywordtype">Private</span>&gt;<span class="keyword">False</span>&lt;/<span class="keywordtype">Private</span>&gt;</div><div class="line">  &lt;/<span class="keywordtype">Reference</span>&gt;</div><div class="line">  &lt;<span class="keywordtype">Reference</span> <span class="keyword">Include</span>=<span class="stringliteral">&quot;UnityEngine&quot;</span> <span class="keyword">Condition</span>=<span class="stringliteral">&quot; Exists(&#39;$(UNITY_DLL_PATH)&#39;) &quot;</span>&gt;</div><div class="line">    &lt;<span class="keywordtype">HintPath</span>&gt;$(<span class="keyword">UNITY_DLL_PATH</span>)\<span class="keyword">UnityEngine.dll</span>&lt;/<span class="keywordtype">HintPath</span>&gt;</div><div class="line">    &lt;<span class="keywordtype">Private</span>&gt;<span class="keyword">False</span>&lt;/<span class="keywordtype">Private</span>&gt;</div><div class="line">  &lt;/<span class="keywordtype">Reference</span>&gt;</div><div class="line">&lt;/<span class="keywordtype">ItemGroup</span>&gt;</div></div><!-- fragment --><h1><a class="anchor" id="sectest"></a>
Testing a 3rd Eye Scene Plugin</h1>
<p>The build guidelines above illustrate how to integrate a user plugin into a pre-built version of the 3<sup>rd</sup> Eye Scene viewer. To facilitate debugging and testing, it is recommended that user plugin DLLs are added to the 3<sup>rd</sup> Eye Scene viewer Unity project instead. Build the DLL as described above, then copy the DLL into the viewer Assets folder under: <code>Assets/plugins</code>. Unity will automatically include this DLL while running under in the Unity editor and on building the project.</p>
<h2><a class="anchor" id="Custom"></a>
3&lt;sup&gt;rd&lt;/sup&gt; Eye Scene Viewer Builds</h2>
<p>There is an alternative way to author custom <code><a class="el" href="classTes_1_1Runtime_1_1MessageHandler.html">MessageHandler</a></code> implementations. In this option, the custom handlers are packaged as part of the 3<sup>rd</sup> Eye Scene viewer as a customised viewer build. This may be more convenient when distribution is tightly controlled and provides an simpler workflow.</p><ol type="1">
<li>Define the messages for the user entities (generally shapes)</li>
<li>Open the 3<sup>rd</sup> Eye Scene viewer Unity project.</li>
<li>Define client messages and associated <code><a class="el" href="classTes_1_1Runtime_1_1MessageHandler.html">MessageHandler</a></code> objects within this project.</li>
<li>Implement the client messages in C# and equivalent server messages in C++</li>
<li>Build the viewer with user extensions built-in.</li>
</ol>
<p>It is recommended that the viewer executable name is changed in these circumstances, to reflect the custom build to avoid confusion with the default 3<sup>rd</sup> Eye Scene viewer application.</p>
<h1><a class="anchor" id="secexample"></a>
Example Plugin</h1>
<p>An example plugin project and program are provided as part of the C# core libraries. To see the plugin in in effect:</p><ol type="1">
<li>Build the 3esCore C# project.</li>
<li>Build the 3<sup>rd</sup> Eye Scene viewer application.</li>
<li>Find 3esExamplePlugin.dll under 3esExamplePlugin/bin/Release</li>
<li>Copy 3esExamplePlugin.dll into the viewer plugins directory.<ul>
<li>You will have to create this directory alongside the exectuable.</li>
</ul>
</li>
<li>Run 3esPluginTest.exe</li>
<li>Run the viewer and connect to the loopback address on the default port. You should see a white pyramid alongside the axis arrows. </li>
</ol>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="index.html">3rd Eye Scene Documentation</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>
