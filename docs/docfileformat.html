<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>3rd Eye Scene: File Format</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript">
$(document).ready(initResizable);
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.7.4 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">3rd Eye Scene</div>
   <div id="projectbrief">3rd Eye Scene documentation</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li id="searchli">
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('docfileformat.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">File Format </div>  </div>
</div>
<div class="contents">
<div class="textblock"><p>3rd Eye Scene files are client recordings from a 3<sup>rd</sup> Eye Scene server connection. 3rd Eye Scene files normally have a '.3es' extension. The simplest such file is simply a direct serialisation of the incoming message packets, as documented in <a class="el" href="docprotocol.html">Messaging Protocol</a> . The incoming messages are serialised as is; packet header, payload and CRC. However, a well formed 3es file should follow the guidelines described below and may optionally compress the file.</p>
<h2><a class="anchor" id="secfilelayload"></a>
Layout</h2>
<p>A well formed 3es file is always begins with a <a class="el" href="docprotocol.html#secserverinfomsg">server info</a> message. This identifies the server characteristics and coordinate frame for correct playback. This message is immediately followed by a <em>frame</em> <em>count</em> <a class="el" href="docprotocol.html#seccontrolmsg">control message</a>. This identifies the total number of recorded frames in the file. Both these messages must always appear in the file uncompressed.</p>
<p>Item | Description ------------------------- | --------------------------------------------------- Server Info | A <a class="el" href="docprotocol.html#secserverinfomsg">server info</a> message detailing the server setting. Frame Count | Optional <a class="el" href="docprotocol.html#seccontrolmsg">control message</a> setting the number of frames in the recording. [Compression Begins] | Optional GZIP compression begins here. Preceding data are uncompressed. World State Serialisation | Optional (recommended) serialisation of the world state at the start of recording. Message Serialisation | Recorded messages.</p>
<p>Data following the server info and frame count control message may appear either compressed or uncompressed. The two leading message are then followed by a serialisation of the client world state at the start of recording. That is, on beginning recording, the viewer will serialise create and data messages required to instantiate the objects already present on the viewing client. This ensures the correct initial state for subsequent messages.</p>
<p>The remainder of the file is simply a serialisation of the incoming server message packets with optional file level compression.</p>
<h3><a class="anchor" id="secfileoptions"></a>
secfileoptions</h3>
<p>The following components of a 3es recording are optional, though some are highly recommended and should generally be expected to be present:</p>
<ul>
<li>A frame count <a class="el" href="docprotocol.html#seccontrolmsg">control message</a> following the server info message (highly recommended).</li>
<li>World state serialisation as described above (highly recommended).</li>
<li><a class="el" href="docfileformat.html#secfilecompression">Compression</a></li>
<li><a class="el" href="docprotocol.html#seccameramsg">Camera messages</a> representing the viewing application's camera state.</li>
</ul>
<p>Note the world state serialisation is optional, but highly recommended. While 3<sup>3r</sup> Eye Scene viewer does serialise the world state, some recording applications may be unable to recognise the world state. For instance, the core release of 3<sup>3r</sup> Eye Scene also features a command line recording application. This application is a dumb application which does nothing to interpret the incoming messages. As such it does not know the world state and cannot serialise one. Such an application is intended to connect as the server application starts and record all incoming packets, thus obviating the need for a world state serialisation.</p>
<p>Camera messages are also optional, primarily because not all recording applications have a client camera representation (such as the command line recording application).</p>
<h3><a class="anchor" id="secfilecompression"></a>
Compression</h3>
<p>3es files use GZIP compression. The recommended supporting libraries for GZIP compression are <a href="http://www.zlib.net/">zlib</a> in GZIP mode, <a href="https://msdn.microsoft.com/en-us/library/system.io.compression.gzipstream(v=vs.110).aspx">GZipStream</a> from the .Net core libraries, or the GZipStream port to Unity provided as part of the Tes.Compression namespace, thanks to <a href="http://www.hitcents.com/">Hitcents</a>.</p>
<p>GZIP compression begins immeidately after the expected <a class="el" href="docprotocol.html#secserverinfomsg">server info</a> and generally expected frame count messages.</p>
<p>NOTE: The GZIP compression scheme is likely to change soon to break up the file into smaller compressed sections. This is to support jumping to key frames in the file. The net result is that the GZIP stream should be terminated after every N bytes (to be decided) and an uncompressed maker packet inserted into the stream before resuming a new GZIP compression stream. The viewer can then serialise the world state at every marker packet as a key frame. Step back, which currently begins playback from the start of the file, can then jump to a specific keyframe, restore the serialised state for that keyframe, and resume streaming. Note that the viewing application manages the key frame serialisation; there are no keyframes in the 3es file itself. </p>
</div></div>
</div>
  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="main.html">3rd Eye Scene Documentation</a>      </li>
      <li class="footer">Generated by&#160;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.4 </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>


</body>
</html>
